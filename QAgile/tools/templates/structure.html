{% extends 'base.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'js/jquery.dataTables.min.css' %}" >
<link rel="stylesheet" type="text/css" href="{% static 'DataTables/Buttons-1.6.1/css/buttons.dataTables.css' %}" >
<link rel="stylesheet" type="text/css" href="{% static 'DataTables/Select-1.3.1/css/select.dataTables.css' %}" >
<!-- <link rel="stylesheet" type="text/css" href="{% static 'DataTables/Editor-2020-03-24-1.9.2/css/editor.dataTables.css' %}" >-->
<script type="text/javascript" src="{% static 'js/jquery.dataTables.min.js' %}" type="javascript"></script>
<script type="text/javascript" src="{% static 'DataTables/Buttons-1.6.1/js/dataTables.buttons.js' %}" type="javascript"></script>
<script type="text/javascript" src="{% static 'DataTables/Select-1.3.1/js/dataTables.select.js' %}" type="javascript"></script>
<!-- <script type="text/javascript" src="{% static 'DataTables/Editor-2020-03-24-1.9.2/js/dataTables.editor.js' %}" type="javascript"></script>-->
<style>
    .row_edit{
        display:none;
    }
</style>

<div>
    <h2>File Definition for <b>{{ffdata.name}}</b></h2>
<div>
    <form>
    <table id="rfstable" class="display" >
        <thead>
        <tr>
            <th></th>
            <th>Id</th>
            <th>Order</th>
            <th>Column</th>
            <th>Data Type</th>
            <th>Max Len</th>
            <th>Key</th>
            <th>Required</th>
            <th>Is Fixed Len</th>
            <th>Min Value</th>
            <th>Max Value</th>
            <th>Decimals</th>
            <th>Format</th>
            <th>All Blanks</th>
        </tr>
        </thead>
        <tbody>
            {% for row in ffdetails %}
                <tr>
                    <td>
                        <form name="ffform_{{row.record_id}}" method="get" action="add-edit?field={{row.record_id}}">
                            {% csrf_token %}
                            <button class="greenbuttons" type="submit">Edit</button>
                        </form>
                    </td>
                    <td>{{row.record_id}}</td>
                    <td id="order">
                        <span id="order_val" class="row_val">{{row.order}}</span>
                        <span id="order_edit" class="row_edit">
                            <input name="field_order" size="2" value="{{row.order}}">
                        </span>
                    </td>
                    <td id="col_name">
                        <span id="col_name_val"  class="row_val">{{row.col_name}}</span>
                        <span id="col_name_edit" class="row_edit">
                            <input name="field_col_name" size="10" value="{{row.col_name}}">
                        </span>
                    </td>
                    <td id="col_data_type">
                        <span id="col_data_type_val" class="row_val">{{row.col_data_type}}</span>
                        <span id="col_data_type_edit" class="row_edit">
                            <select name="field_col_data_type">
                                <option value="INT" {% if row.col_data_type == 'INT' %} selected {% endif %}>INT</option>
                                <option value="STRING" {% if row.col_data_type == 'STRING' %} selected {% endif %}>STRING</option>
                                <option value="DECIMAL" {% if row.col_data_type == 'DECIMAL' %} selected {% endif %}>DECIMAL</option>
                                <option value="DATE" {% if row.col_data_type == 'DATE' %} selected {% endif %}>DATE</option>
                            </select>
                        </span>
                    </td>
                    <td id="max_len">
                        <span id="max_len_val" class="row_val">{{row.max_len}}</span>
                        <span id="max_len_edit" class="row_edit">
                            <input name="field_max_len" size="5" value="{{row.max_len}}">
                        </span>
                    </td>
                    <td id="is_pk">
                        <span id="is_pk_val" class="row_val">{% if row.is_pk == 0 %}
                        No
                        {% else %}
                        Yes
                        {% endif %}</span>
                        <span id="is_pk_edit" class="row_edit">
                            Yes<input type="radio" name="field_is_pk" value="Yes" {% if row.is_pk == 1 %} selected {% endif %}>
                            No<input type="radio" name="field_is_pk" value="No" {% if row.is_pk == 0 %} selected {% endif %}>
                        </span>
                    </td>

                    <td id="required">
                        <span id="required_val" class="row_val"> {% if row.required == 0 %}
                        No
                        {% else %}
                        Yes
                        {% endif %}</span>
                        <span id="required_edit" class="row_edit">
                            Yes<input type="radio" name="field_required" value="Yes" {% if row.required == 1 %} checked {% endif %}>
                            No<input type="radio" name="field_required" value="No" {% if row.required == 0 %} checked {% endif %}>
                        </span>
                    </td>

                    <td id="is_fixed_len">
                        <span id="is_fixed_len_val" class="row_val">{% if row.is_fixed_len == 0 %}
                            {% if ffdata.file_type != 'FIXED' %}    No {% endif %}
                        {% else %}
                        Yes
                        {% endif %}</span>
                        <span id="is_fixed_len_edit" class="row_edit">
                            Yes<input type="radio" name="field_is_fixed_len" value="Yes" {% if row.is_fixed_len == 'FIXED' %} checked {% endif %}>
                            No<input type="radio" name="field_is_fixed_len" value="No" {% if row.is_fixed_len != 'FIXED' %} checked {% endif %}>
                        </span>
                    </td>

                    <td id="min_value">
                        <span id="min_value_val" class="row_val">{{row.min_value}}</span>
                        <span id="min_value_edit" class="row_edit">
                            <input name="field_min_value" size="5" value="{{row.min_value}}">
                        </span>
                    </td>

                    <td id="max_value">
                        <span id="max_value_val" class="row_val">{{row.max_value}}</span>
                        <span id="max_value_edit" class="row_edit">
                            <input name="field_max_value" size="5" value="{{row.min_value}}">
                        </span>
                    </td>

                    <td id="decimals">
                        <span id="decimals_val" class="row_val">{{row.decimals}}</span>
                        <span id="decimals_edit" class="row_edit">
                            <input name="field_decimals" size="5" value="{{row.decimals}}">
                        </span>
                    </td>

                    <td id="format">
                        <span id="format_val" class="row_val">{{row.format}}</span>
                        <span id="format_edit" class="row_edit">
                            <select name="field_format">
                                <option value="FIXED" {% if row.format == 'FIXED' %} selected {% endif %}>FIXED</option>
                                <option value="CSV" {% if row.format == 'CSV' %} selected {% endif %}>CSV</option>
                                <option value="TAB" {% if row.format == 'TAB' %} selected {% endif %}>TAB</option>
                                <option value="PIPE" {% if row.format == 'PIPE' %} selected {% endif %}>PIPE</option>
                            </select>
                        </span>
                    </td>

                    <td id="all_null">
                        <span id="all_null_val" class="row_val">{% if row.all_null == 0 %}
                        No
                        {% else %}
                        Yes
                        {% endif %}</span>
                        <span id="all_null_edit" class="row_edit">
                            Yes<input type="radio" name="field_all_null" value="Yes" {% if row.all_null == 1 %} checked="checked" {% endif %}>
                            No<input type="radio" name="field_all_null" value="No" {% if row.all_null == 0 %} checked="checked" {% endif %}>
                        </span>
                    </td>
                </tr>
            {% endfor   %}
        </tbody>
    </table>
    </form>

</div>

<script>
    var editor;

    $(document).ready(function() {
    /*editor = new $.fn.dataTable.Editor( {
            ajax: "../php/staff.php",
            table: "#rfstable",
            idSrc:  'record_id',
            dom: "Bfrtip",
            fields: [ {
                    label: "ID:",
                    name: "record_id",
                    type: "readonly"
                },{
                    label: "Column:",
                    name: "order"
                },{
                    label: "Column:",
                    name: "col_name"
                }, {
                    label: "Data Type:",
                    name: "col_data_type",
                    type: "select",
                    options: [
                    { label: "INT", value: "INT" },
                    { label: "STRING", value: "STRING" },
                    { label: "DECIMAL", value: "DECIMAL" },
                    { label: "DATE", value: "DATE" }
                    ]
                }, {
                    label: "Max Len:",
                    name: "max_len"
                }, {
                    label: "Key:",
                    name: "is_pk",
                    type: "radio",
                options: [
                    { label: "Yes", value: 1 },
                    { label: "No", value: 0 }
                ]
                }, {
                    label: "Required:",
                    name: "required",
                    type: "radio",
                options: [
                    { label: "Yes", value: 1 },
                    { label: "No", value: 0 }
                ]
                }, {
                    label: "Is Fixed Len:",
                    name: "is_fixed_len",
                    type: "radio",
                options: [
                    { label: "Yes", value: 1 }
                    {% if ffdata.file_type != 'FIXED' %}  ,{ label: "No", value: 0 } {% endif %}
                ]
                },{
                    label: "Min Value:",
                    name: "min_value"
                },{
                    label: "Max Value:",
                    name: "max_value"
                },{
                    label: "Decimals:",
                    name: "decimals"
                },
                {
                    label: "Format:",
                    name: "format"
                }, {
                    label: "All Blanks:",
                    name: "all_null",
                    type: "radio",
                options: [
                    { label: "Yes", value: 1 },
                    { label: "No", value: 0}
                ]
                }
            ]
        } );

        editor.on('open', function () {
            $('div.DTE_Footer').css( 'text-indent', -1 );
            $(".DTE_Body").css("padding","30px");

            {% for row in ffdetails %}

            {% endfor %}

            editor.field('required').val(1);
        $(".DTE_Footer").show();
        });




        // Activate an inline edit on click of a table cell
       // $('#rfstable').on( 'click', 'tbody td:not(:first-child)', function (e) {
        //    editor.bubble( this );
        //} );

        $("#rfstable").on( 'click', 'tbody td:not(.noedit)', function (e,ref) {
                    editor.inline( this );
        });
        */

        // Activate an inline edit on click of a table cell
        $('#rfstable').on( 'click', 'tbody td:not(:first-child)', function (e) {
            console.log(this);
            $("#"+this.id+"_val").hide();
            $(".row_edit").hide();
            $("#"+this.id+"_edit").show();
        } );

        $(".row_edit").on("blur", function(){
            $(".row_edit").hide();
            $(".row_val").show();
        });

        $('#rfstable').DataTable( {
            dom: "Bfrtip",
            order: [[ 1, 'asc' ]],
            columns: [
                {
                    data: null,
                    defaultContent: '',
                    className: 'select-checkbox',
                    orderable: false
                },
                { data: "record_id" },
                { data: "order" },
                { data: "col_name" },
                { data: "col_data_type" },
                { data: "max_len" },
                { data: "is_pk", editField: "is_pk" },
                { data: "required" },
                { data: "is_fixed_len" },
                { data: "min_value"},
                { data: "max_value"},
                { data: "decimals"},
                { data: "format"},
                { data: "all_null"}
            ],
            select: {
                style:    'os',
                selector: 'td:first-child'
            },
            buttons: [
                { extend: "create", editor: editor },
                { extend: "edit",   editor: editor },
                { extend: "remove", editor: editor }
            ]
        } );


    } );

</script>

{% endblock %}